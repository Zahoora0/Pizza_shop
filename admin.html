<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | Menu Management</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="topbar">
  <div class="topbar-inner">
    <div class="top-left">
      <a class="btn" href="index.html">Home</a>
      <a class="btn" href="menu.html">Menu</a>
    </div>

    <div class="top-center">
      <img class="brand-logo" src="IMG/logo.png" alt="8th Ave Pizzeria Logo" />
    </div>

    <div class="top-right">
      <a class="btn" href="order-status.html">Track Order</a>
    </div>
  </div>
</header>

<main style="max-width: 980px; margin: 40px auto; padding: 0 16px;">
  <h1 style="margin-bottom: 10px;">Menu Management (Admin)</h1>
  <p style="margin-top: 0;">Add, edit, or delete menu items. Changes show on the customer menu.</p>

  <div style="display:grid; grid-template-columns: 1fr; gap: 14px; margin-top: 18px;">
    <div style="border:1px solid #e5e5e5; border-radius:16px; padding:16px;">
      <h3 style="margin-top:0;">Add / Update Item</h3>

      <form id="itemForm" style="display:grid; gap:10px; max-width: 520px;">
        <input id="itemId" type="hidden" />

        <label>
          Name
          <input id="name" type="text" required style="width:100%; padding:10px; border-radius:10px; border:1px solid #ccc;" />
        </label>

        <label>
          Price (USD)
          <input id="price" type="number" step="0.01" min="0.01" required style="width:100%; padding:10px; border-radius:10px; border:1px solid #ccc;" />
        </label>

        <label>
          Category
          <select id="category" required style="width:100%; padding:10px; border-radius:10px; border:1px solid #ccc;">
            <option value="Pizza">Pizza</option>
            <option value="Sides">Sides</option>
            <option value="Drinks">Drinks</option>
          </select>
        </label>

        <label>
          Image (optional path, e.g., IMG/pizza1.png)
          <input id="image" type="text" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ccc;" />
        </label>

        <label style="display:flex; gap:10px; align-items:center;">
          <input id="active" type="checkbox" checked />
          Active (visible to customers)
        </label>

        <div style="display:flex; gap:10px;">
          <button class="btn" type="submit">Save Item</button>
          <button class="btn" type="button" id="resetBtn">Clear</button>
        </div>

        <div id="msg" style="font-weight:600;"></div>
      </form>
    </div>

    <div style="border:1px solid #e5e5e5; border-radius:16px; padding:16px;">
      <h3 style="margin-top:0;">Current Menu</h3>
      <div id="list" style="display:grid; gap:10px;"></div>
    </div>
  </div>
</main>

<script>
  function getMenu() {
    return JSON.parse(localStorage.getItem("menuItems")) || [];
  }
  function setMenu(items) {
    localStorage.setItem("menuItems", JSON.stringify(items));
  }
  function uid() {
    return "m_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function validateItem(data) {
    if (!data.name || data.name.trim().length < 2) return "Name is required.";
    if (!Number.isFinite(data.price) || data.price <= 0) return "Price must be greater than 0.";
    return "";
  }

  function renderList() {
    const list = document.getElementById("list");
    const items = getMenu();

    if (!items.length) {
      list.innerHTML = `<div style="opacity:.7;">No items yet. Add one above.</div>`;
      return;
    }

    list.innerHTML = items.map(item => `
      <div style="border:1px solid #eee; border-radius:14px; padding:12px; display:flex; justify-content:space-between; gap:12px; align-items:center;">
        <div>
          <div style="font-weight:800;">${item.name} ${item.active ? "" : "(Hidden)"}</div>
          <div style="opacity:.8;">${item.category} â€¢ $${Number(item.price).toFixed(2)}</div>
          <div style="opacity:.7; font-size: 12px;">id: ${item.id}</div>
        </div>
        <div style="display:flex; gap:10px;">
          <button class="btn" type="button" data-edit="${item.id}">Edit</button>
          <button class="btn" type="button" data-del="${item.id}">Delete</button>
        </div>
      </div>
    `).join("");
  }

  const form = document.getElementById("itemForm");
  const msg = document.getElementById("msg");

  function clearForm() {
    document.getElementById("itemId").value = "";
    document.getElementById("name").value = "";
    document.getElementById("price").value = "";
    document.getElementById("category").value = "Pizza";
    document.getElementById("image").value = "";
    document.getElementById("active").checked = true;
    msg.textContent = "";
  }

  document.getElementById("resetBtn").addEventListener("click", clearForm);

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const id = document.getElementById("itemId").value || uid();
    const data = {
      id,
      name: document.getElementById("name").value.trim(),
      price: Number(document.getElementById("price").value),
      category: document.getElementById("category").value,
      image: document.getElementById("image").value.trim(),
      active: document.getElementById("active").checked
    };

    const err = validateItem(data);
    if (err) {
      msg.textContent = err;
      msg.style.color = "crimson";
      return;
    }

    const items = getMenu();
    const i = items.findIndex(x => x.id === id);
    if (i >= 0) items[i] = data; else items.unshift(data);

    setMenu(items);
    msg.textContent = "Saved.";
    msg.style.color = "green";
    clearForm();
    renderList();
  });

  document.addEventListener("click", (e) => {
    const editId = e.target.getAttribute("data-edit");
    const delId = e.target.getAttribute("data-del");
    const items = getMenu();

    if (editId) {
      const item = items.find(x => x.id === editId);
      if (!item) return;
      document.getElementById("itemId").value = item.id;
      document.getElementById("name").value = item.name;
      document.getElementById("price").value = item.price;
      document.getElementById("category").value = item.category;
      document.getElementById("image").value = item.image || "";
      document.getElementById("active").checked = !!item.active;
      msg.textContent = "Editing item...";
      msg.style.color = "#333";
    }

    if (delId) {
      const next = items.filter(x => x.id !== delId);
      setMenu(next);
      renderList();
    }
  });

  renderList();
</script>

</body>
</html>
